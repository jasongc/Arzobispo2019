@{
    int OrganizationTypeId = -1;
    string SectorCodigo = "";
    string IdentificationNumber = "";
    string SectorName = "";
    string Name = "";
    string ContacName = "";
    string EmailContacto = "";
    string Contacto = "";
    string Mail = "";
    string ContactoMedico = "";
    string Address = "";
    string Observation = "";
    string PhoneNumber = "";
    string EmailMedico = "";
    string OrganizationId = "";

    if (ViewBag.Company != null)
    {

        OrganizationTypeId = ViewBag.Company.OrganizationTypeId;
        SectorCodigo = ViewBag.Company.SectorCodigo;
        IdentificationNumber = ViewBag.Company.IdentificationNumber;
        SectorName = ViewBag.Company.SectorName;
        Name = ViewBag.Company.Name;
        ContacName = ViewBag.Company.ContacName;
        EmailContacto = ViewBag.Company.EmailContacto;
        Contacto = ViewBag.Company.Contacto;
        Mail = ViewBag.Company.Mail;
        ContactoMedico = ViewBag.Company.ContactoMedico;
        Address = ViewBag.Company.Address;
        Observation = ViewBag.Company.Observation;
        PhoneNumber = ViewBag.Company.PhoneNumber;
        EmailMedico = ViewBag.Company.EmailMedico;
        OrganizationId = ViewBag.Company.OrganizationId;

    }
}


<style>
    .Titulo {
        font-weight: bolder;
        font-size: 20px;
        text-align: center;
    }

    .SubTitulo {
        margin-top: 20px;
    }

    select {
        width: 186px;
        height: 28px;
    }

    .IconoMas {
        cursor: pointer;
        width: 20px;
        float: right;
    }


    #Loading {
        background-color: rgba(0, 0, 0, 0.60);
        position: fixed;
        left: 0px;
        top: 0px;
        z-index: 9999;
    }

        #Loading > img {
            width: 200px;
        }

    #Accordion-Container {
        overflow: hidden;
        height: 0px;
    }

    .border {
        border: 1px solid black;
        border-radius: 20px;
        margin: 40px 20px 0px;
        padding: 20px;
    }

    input, select {
        width: 100%;
        max-width: 100%;
        height: 38px;
    }
</style>

<form style="width:100%;">
    <div class="container-fluid">
        <div class="col-12 p-0">
            <div class="row d-flex justify-content-center">
                <div class="col-12 col-md-8 col-lg-7 col-xl-6 border">
                    <div class="row">
                        <div class="col-12 Titulo">Datos de la empresa</div>
                    </div>
                    @*combo categoria*@
                    <div class="row">
                        <div class="col-5 col-md-6">
                            <div class="SubTitulo">Tipo: </div>
                            <div>
                                @{
                                    if (ViewBag.OrgType != null)
                                    {
                                        <select class="dropdown" id="OrganizationTypeId" data-validation="number" data-validation-allowing="range[1;100]" data-validation-error-msg="Debe seleccionar una opción">
                                            @foreach (SigesoftWeb.Models.Common.Dropdownlist G in ViewBag.OrgType)
                                            {
                                                <option value="@G.Id" @(OrganizationTypeId == int.Parse(G.Id.ToString()) ? "selected" : "")>@G.Value</option>
                                            }
                                        </select>
                                    }
                                }
                            </div>
                        </div>
                        <div class="col-4 ">
                            <div class="SubTitulo">C.I.I.U: </div>
                            <div><input type="text" id="SectorCodigo" disabled value="@SectorCodigo" /></div>
                        </div>
                        <div class="col-3 col-md-2">
                            <div class="SubTitulo">RUC: </div>
                            <div><input type="text" id="IdentificationNumber" value="@IdentificationNumber" data-validation="length" data-validation-length="8-50" data-validation-error-msg="El RUC debe de tener más de 8 caracteres" /></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <div class="SubTitulo">Sector: </div>
                            <div><input type="text" id="SectorName" value="@SectorName" data-validation="length" data-validation-length="3-50" data-validation-error-msg="El nombre del sector debe tener más de 3 caracteres" /></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-12">
                            <div class="SubTitulo">Razon Social: </div>
                            <div><input type="text" id="Name" value="@Name" data-validation="length" data-validation-length="3-50" data-validation-error-msg="Debe contener más de 3 caracteres" /></div>
                        </div>
                    </div>


                    <div class="row">
                        <div class="col-8">
                            <div class="SubTitulo">Representante Legal: </div>
                            <div><input type="text" id="ContacName" value="@ContacName" /></div>
                        </div>
                        <div class="col-4">
                            <div class="SubTitulo">Email: </div>
                            <div><input type="text" id="EmailContacto" value="@EmailContacto" /></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-8">
                            <div class="SubTitulo">Contacto RRHH: </div>
                            <div><input type="text" id="Contacto" value="@Contacto" /></div>
                        </div>
                        <div class="col-4">
                            <div class="SubTitulo">Email: </div>
                            <div><input type="text" id="Mail" value="@Mail" /></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-8">
                            <div class="SubTitulo">Contacto Médico: </div>
                            <div><input type="text" id="ContactoMedico" value="@ContactoMedico" /></div>
                        </div>
                        <div class="col-4">
                            <div class="SubTitulo">Email: </div>
                            <div><input type="text" id="EmailMedico" value="@EmailMedico" /></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-12">
                            <div class="SubTitulo">Dirección: </div>
                            <div><input type="text" id="Address" value="@Address" /></div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-8">
                            <div class="SubTitulo">Observaciones: </div>
                            <div><input type="text" id="Observation" value="@Observation" /></div>
                        </div>
                        <div class="col-4">
                            <div class="SubTitulo">Teléfono: </div>
                            <div><input type="text" id="PhoneNumber" value="@PhoneNumber" /></div>
                        </div>
                    </div>
                </div>
                <div class="col-12 p-0 m-2 d-flex justify-content-center">
                    <div class="row">
                        <div class="col">
                            <button class="btn mt-2 mt-sm-0 pl-lg-5 pr-lg-5 btn-info boton form-control ">
                                <i class="fa fa-search"></i> Guardar
                            </button>
                        </div>
                        <div class="col">
                            <button type="button" class="btn mt-2 mt-sm-0  pl-lg-5 pr-lg-5 btn-info boton form-control" onclick="location.href='@Url.Action("Index","Organization")'">
                                <i class="fa fa-search"></i> Cancelar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</form>

<div class="alert" role="alert" style="display:none;">
    <button type="button" class="close" data-dismiss="alert" aria-label="Close"></button>
    <span></span>
</div>

<div id="Loading" style="display:none;">
    <img src="~/Content/Images/loading.gif" />
</div>
@section scripts{
    <script src="~/Scripts/JqueryFormValidate.js"></script>
    <script src="~/Scripts/FormValidateSecurity.js"></script>
    <link href="~/Content/Themes/FormValidatorTheme.css" rel="stylesheet" type="text/css" />


    <script>
        $.validate({
            modules: 'security'
        });

        $('form').submit(function (event) {
            event.preventDefault();
            EnviarFormulario();
        });


    function EnviarFormulario() {
        var data = {

            OrganizationTypeId: $("#OrganizationTypeId").val(),
            SectorCodigo: $("#SectorCodigo").val(),
            IdentificationNumber: $("#IdentificationNumber").val(),
            SectorName: $("#SectorName").val(),
            Name: $("#Name").val(),
            ContacName: $("#ContacName").val(),
            EmailContacto: $("#EmailContacto").val(),
            Contacto: $("#Contacto").val(),
            Mail: $("#Mail").val(),
            ContactoMedico: $("#ContactoMedico").val(),
            Address: $("#Address").val(),
            Observation: $("#Observation").val(),
            PhoneNumber: $("#PhoneNumber").val(),
            EmailMedico: $("#EmailMedico").val(),
            OrganizationId: '@OrganizationId'

        };

        var width = $(window).width();
        var height = $(window).height();

        $("#Loading").show().css("width", width + "px").css("height", height + "px");
        $("#Loading > img").css("margin-left", ((width - 200) / 2) + "px").css("margin-top", ((height - 266) / 2) + "px");

        $.ajax({
            cache: false,
            dataType: 'json',
            method: 'POST',
            data: data,
            url: '@(ViewBag.Company != null  ? "/Organization/EditCompany" : "/Organization/AddCompany")',
            success: function (json) {
                $("#Loading").hide();
                if (json) {
                    location.href = '@Url.Action("Index", "Organization")';
                } else {

                    alerta("No se pudo guardar el producto", "rojo");
                }
            },
            error: function (error) {
                alerta("Sucedió un error al conectarse al servidor", "rojo");
                $("#Loading").hide();
                console.log(error);
            }
        });
    }
    function updateAccordionHeight() {
        setTimeout(function () {
            $("#Accordion-Container").animate({
                height: $("#Accordion-Container > .row").height() + "px"
            }, 600);
        }, 200);
        }
    </script>
}



